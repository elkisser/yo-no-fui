---
import MainLayout from "../layouts/MainLayout.astro";
import {
  Gamepad2,
  Target,
  Zap,
  Users,
  Clock,
  Brain,
  Trophy,
  Sparkles,
  Shield,
  Lock,
  Search,
  FileText,
  ChevronRight,
  Star,
  Award,
  TrendingUp,
  Puzzle,
  Fingerprint,
  Briefcase,
  BarChart3,
  Crown,
} from "lucide-react";
import Logo from "../components/ui/Logo";
---

<MainLayout>
  <!-- Fondo de juego con efecto de expediente -->
  <div class="relative min-h-screen overflow-hidden bg-fondo-principal">
    <!-- Textura de papel viejo/expediente -->
    <div class="absolute inset-0 opacity-5">
      <div
        class="absolute inset-0"
        style="background-image: url('data:image/svg+xml,%3Csvg width=\"
        100\"
        height='\"100\"'
        xmlns='\"http://www.w3.org/2000/svg\"%3E%3Cpath'
        d='\"M0'
        0h100v100H0z\"
        fill='\"none\"'
        stroke='\"%234DA3FF\"'
        stroke-width='\"0.5\"'
        stroke-dasharray='\"2,2\"'
        opacity='\"0.2\"/%3E%3C/svg%3E&apos;);"'
      >
      </div>
    </div>

    <!-- Elementos de detective -->
    <div class="absolute inset-0 overflow-hidden pointer-events-none">
      <!-- Lupa gigante (sutil) -->
      <div class="absolute top-20 right-10 w-64 h-64 opacity-5">
        <div class="w-full h-full rounded-full border-2 border-acento-azul">
        </div>
        <div
          class="absolute top-1/2 right-1/2 w-32 h-0.5 bg-acento-azul transform rotate-45"
        >
        </div>
      </div>

      <!-- Huellas digitales (muy sutiles) -->
      <div class="absolute bottom-40 left-20 w-40 h-40 opacity-3">
        <div
          class="w-8 h-12 rounded-full border border-acento-turquesa transform rotate-12"
        >
        </div>
      </div>
    </div>

    <!-- Contenido principal -->
    <div class="relative z-10">
      <!-- Hero Section - Estilo expediente policial -->
      <section class="pt-24 pb-20 px-4">
        <div class="max-w-7xl mx-auto">
          <!-- Logo del juego - Expediente oficial -->
          <div class="text-center mb-16 animate-fade-in">
            <div class="inline-block mb-10 relative group">
              {/* Expediente oficial */}
              <div class="relative w-64 h-64 mx-auto">
                {/* Carpeta de expediente */}
                <div
                  class="absolute inset-0 bg-gradient-to-br from-fondo-panel to-fondo-secundario rounded-2xl transform rotate-2 shadow-2xl shadow-black/30"
                >
                </div>

                {/* Expediente principal */}
                <div
                  class="relative w-full h-full bg-gradient-to-br from-fondo-panel/90 to-fondo-panel/80 backdrop-blur-sm border border-fondo-borde/60 rounded-xl p-8 transition-all duration-500"
                >
                  <div class="flex flex-col h-full text-center">
                    <!-- Bloque superior / central -->
                    <div
                      class="flex-1 flex flex-col items-center justify-center space-y-4"
                    >
                      <!-- Sello oficial -->
                      <Logo />

                      <!-- Tipo de documento -->
                      <div
                        class="text-sm tracking-[0.28em] text-acento-azul/80 uppercase"
                        data-typewriter
                      >
                        EXPEDIENTE CRIMINAL
                      </div>
                    </div>

                    <!-- Pie del expediente -->
                    <div
                      class="text-[11px] text-texto-secundario tracking-widest font-mono border-t border-fondo-borde/40 pt-3 mt-4"
                    >
                      CASO #001 · CLASIFICACIÓN CONFIDENCIAL
                    </div>
                  </div>
                </div>

                {/* Clip de carpeta */}
                <div
                  class="absolute -top-4 left-1/2 transform -translate-x-1/2 w-16 h-8 bg-gradient-to-b from-gray-600 to-gray-800 rounded-t-lg"
                >
                </div>

                {/* Tachuelas */}
                <div
                  class="absolute -top-2 -left-2 w-4 h-4 rounded-full bg-gradient-to-br from-yellow-600 to-yellow-800 shadow-lg"
                >
                </div>
                <div
                  class="absolute -top-2 -right-2 w-4 h-4 rounded-full bg-gradient-to-br from-yellow-600 to-yellow-800 shadow-lg"
                >
                </div>
              </div>
            </div>

            {/* Slogan de detective */}
            <div class="mb-12">
              <h2 class="text-3xl md:text-4xl font-serif font-bold mb-6">
                <span class="text-texto-principal">
                  La verdad está en los detalles
                </span>
              </h2>
              <p
                class="text-xl text-texto-secundario max-w-3xl mx-auto leading-relaxed mb-8"
              >
                Conviértete en detective y resuelve crímenes únicos generados
                por IA. Cada caso es una narrativa original que pondrá a prueba
                tus habilidades deductivas.
              </p>

              {/* Estadísticas rápidas */}
              <div
                class="inline-flex flex-wrap justify-center gap-4 px-6 py-4 bg-fondo-panel/30 backdrop-blur-sm border border-fondo-borde/50 rounded-xl mb-8"
              >
                <div class="flex items-center gap-3">
                  <div class="w-3 h-3 rounded-full bg-green-400 animate-pulse">
                  </div>
                  <div>
                    <div class="text-sm text-texto-secundario">
                      Casos activos
                    </div>
                    <div
                      class="text-xl font-bold text-texto-principal"
                      id="casos-activos-counter"
                    >
                      0
                    </div>
                  </div>
                </div>

                <div class="w-px h-12 bg-fondo-borde/50"></div>

                <div class="flex items-center gap-3">
                  <div class="w-3 h-3 rounded-full bg-acento-azul"></div>
                  <div>
                    <div class="text-sm text-texto-secundario">Resueltos</div>
                    <div
                      class="text-xl font-bold text-acento-azul"
                      id="casos-resueltos-counter"
                    >
                      0
                    </div>
                  </div>
                </div>
              </div>
            </div>

            {/* Botones principales - Estilo interfaz policial */}
            <div
              class="flex flex-col sm:flex-row gap-6 justify-center items-center mb-16"
            >
              {/* Botón Nueva Investigación */}
              <a
                href="/nuevo-caso"
                class="group relative px-10 py-5 bg-gradient-to-br from-fondo-panel to-fondo-secundario border-2 border-fondo-borde text-texto-principal text-xl font-bold rounded-xl hover:border-acento-azul transition-all duration-300 flex items-center justify-center gap-4 min-w-[280px] shadow-lg hover:shadow-2xl hover:shadow-acento-azul/20"
              >
                {/* Efecto de sello */}
                <div
                  class="absolute -top-3 -right-3 w-8 h-8 rounded-full bg-gradient-to-br from-red-500 to-red-700 flex items-center justify-center shadow-lg"
                >
                  <div class="w-3 h-3 rounded-full bg-white"></div>
                </div>

                {/* Contenido */}
                <FileText
                  class="w-6 h-6 text-acento-azul group-hover:scale-110 transition-transform"
                />
                <span>NUEVA INVESTIGACIÓN</span>
                <ChevronRight
                  class="w-5 h-5 opacity-0 group-hover:opacity-100 transition-all transform group-hover:translate-x-1"
                />

                {/* Línea inferior activa */}
                <div
                  class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-acento-azul to-transparent opacity-0 group-hover:opacity-100 transition-opacity"
                >
                </div>
              </a>

              {/* Botón Continuar (solo si hay caso) */}
              <a
                href="/investigar"
                id="continuar-btn"
                class="hidden group relative px-10 py-5 bg-gradient-to-br from-fondo-panel to-fondo-secundario border-2 border-fondo-borde text-texto-principal text-xl font-bold rounded-xl hover:border-acento-turquesa transition-all duration-300 flex items-center justify-center gap-4 min-w-[280px] shadow-lg hover:shadow-2xl hover:shadow-acento-turquesa/20"
              >
                {/* Indicador de caso activo */}
                <div
                  class="absolute -top-2 -right-2 w-4 h-4 rounded-full bg-green-400 animate-pulse shadow-lg"
                >
                </div>

                {/* Contenido */}
                <Search
                  class="w-6 h-6 text-acento-turquesa group-hover:scale-110 transition-transform"
                />
                <span>CONTINUAR CASO</span>
                <div
                  class="absolute -bottom-6 text-xs text-green-400 font-mono animate-pulse"
                >
                  • INVESTIGACIÓN EN CURSO •
                </div>
              </a>
            </div>
          </div>

          {/* Características del juego - Estilo perfil criminal */}
          <div class="max-w-6xl mx-auto mb-8">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
              <div
                class="bg-gradient-to-br from-fondo-panel/50 to-fondo-panel/30 backdrop-blur-sm border border-fondo-borde/50 rounded-xl p-6 hover:border-acento-azul/50 transition-all duration-300"
              >
                <div class="flex items-start gap-4 mb-4">
                  <div
                    class="w-12 h-12 rounded-lg bg-gradient-to-br from-acento-azul/20 to-acento-azul/10 flex items-center justify-center flex-shrink-0"
                  >
                    <Fingerprint class="w-6 h-6 text-acento-azul" />
                  </div>
                  <div>
                    <h3 class="text-lg font-bold text-texto-principal mb-1">
                      Casos Únicos
                    </h3>
                    <p class="text-sm text-texto-secundario">
                      Generados dinámicamente por IA
                    </p>
                  </div>
                </div>
                <div
                  class="text-xs text-texto-secundario/60 font-mono border-t border-fondo-borde/30 pt-3"
                >
                  SIN REPETICIONES
                </div>
              </div>

              <div
                class="bg-gradient-to-br from-fondo-panel/50 to-fondo-panel/30 backdrop-blur-sm border border-fondo-borde/50 rounded-xl p-6 hover:border-acento-turquesa/50 transition-all duration-300"
              >
                <div class="flex items-start gap-4 mb-4">
                  <div
                    class="w-12 h-12 rounded-lg bg-gradient-to-br from-acento-turquesa/20 to-acento-turquesa/10 flex items-center justify-center flex-shrink-0"
                  >
                    <Briefcase class="w-6 h-6 text-acento-turquesa" />
                  </div>
                  <div>
                    <h3 class="text-lg font-bold text-texto-principal mb-1">
                      Herramientas
                    </h3>
                    <p class="text-sm text-texto-secundario">
                      Análisis forense y verificación
                    </p>
                  </div>
                </div>
                <div
                  class="text-xs text-texto-secundario/60 font-mono border-t border-fondo-borde/30 pt-3"
                >
                  3 AYUDAS/CASO
                </div>
              </div>

              <div
                class="bg-gradient-to-br from-fondo-panel/50 to-fondo-panel/30 backdrop-blur-sm border border-fondo-borde/50 rounded-xl p-6 hover:border-acento-azul/50 transition-all duration-300"
              >
                <div class="flex items-start gap-4 mb-4">
                  <div
                    class="w-12 h-12 rounded-lg bg-gradient-to-br from-acento-azul/20 to-acento-azul/10 flex items-center justify-center flex-shrink-0"
                  >
                    <Users class="w-6 h-6 text-acento-azul" />
                  </div>
                  <div>
                    <h3 class="text-lg font-bold text-texto-principal mb-1">
                      Sospechosos
                    </h3>
                    <p class="text-sm text-texto-secundario">
                      3-5 personajes por caso
                    </p>
                  </div>
                </div>
                <div
                  class="text-xs text-texto-secundario/60 font-mono border-t border-fondo-borde/30 pt-3"
                >
                  MOTIVACIONES COMPLEJAS
                </div>
              </div>

              <div
                class="bg-gradient-to-br from-fondo-panel/50 to-fondo-panel/30 backdrop-blur-sm border border-fondo-borde/50 rounded-xl p-6 hover:border-acento-turquesa/50 transition-all duration-300"
              >
                <div class="flex items-start gap-4 mb-4">
                  <div
                    class="w-12 h-12 rounded-lg bg-gradient-to-br from-acento-turquesa/20 to-acento-turquesa/10 flex items-center justify-center flex-shrink-0"
                  >
                    <BarChart3 class="w-6 h-6 text-acento-turquesa" />
                  </div>
                  <div>
                    <h3 class="text-lg font-bold text-texto-principal mb-1">
                      Progreso
                    </h3>
                    <p class="text-sm text-texto-secundario">
                      Guardado automáticamente
                    </p>
                  </div>
                </div>
                <div
                  class="text-xs text-texto-secundario/60 font-mono border-t border-fondo-borde/30 pt-3"
                >
                  SIN REGISTRO
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      {/* Cómo jugar - Estilo manual de detective */}
      <section
        class="py-32 px-4 bg-gradient-to-b from-transparent to-fondo-secundario/30"
      >
        <div class="max-w-6xl mx-auto">
          <div class="text-center mb-16">
            <div
              class="inline-flex items-center gap-3 mb-6 bg-fondo-panel/50 backdrop-blur-sm border border-fondo-borde/50 rounded-full px-6 py-3"
            >
              <Crown class="w-6 h-6 text-yellow-400" />
              <h2 class="text-3xl font-bold text-texto-principal">
                CÓMO INVESTIGAR
              </h2>
              <Crown class="w-6 h-6 text-yellow-400" />
            </div>
            <p class="text-xl text-texto-secundario max-w-3xl mx-auto">
              Sigue estos pasos para convertirte en un detective de élite
            </p>
          </div>

          <div class="grid md:grid-cols-4 gap-8">
            {/* Paso 1 */}
            <div class="relative group">
              <div
                class="absolute -inset-4 bg-gradient-to-r from-acento-azul/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-300"
              >
              </div>
              <div
                class="relative bg-gradient-to-br from-fondo-panel/50 to-fondo-panel/30 backdrop-blur-sm border border-fondo-borde/50 rounded-xl p-6 text-center"
              >
                <div
                  class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-br from-acento-azul/20 to-acento-azul/10 text-3xl font-bold text-acento-azul mb-6 mx-auto border-2 border-acento-azul/30"
                >
                  1
                </div>
                <h3 class="text-xl font-bold text-texto-principal mb-3">
                  Generar Caso
                </h3>
                <p class="text-texto-secundario text-sm leading-relaxed">
                  Crea un nuevo expediente criminal único generado por IA
                </p>
              </div>
            </div>

            {/* Paso 2 */}
            <div class="relative group">
              <div
                class="absolute -inset-4 bg-gradient-to-r from-acento-turquesa/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-300"
              >
              </div>
              <div
                class="relative bg-gradient-to-br from-fondo-panel/50 to-fondo-panel/30 backdrop-blur-sm border border-fondo-borde/50 rounded-xl p-6 text-center"
              >
                <div
                  class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-br from-acento-turquesa/20 to-acento-turquesa/10 text-3xl font-bold text-acento-turquesa mb-6 mx-auto border-2 border-acento-turquesa/30"
                >
                  2
                </div>
                <h3 class="text-xl font-bold text-texto-principal mb-3">
                  Analizar Pistas
                </h3>
                <p class="text-texto-secundario text-sm leading-relaxed">
                  Examina evidencias, algunas reales y otras engañosas
                </p>
              </div>
            </div>

            {/* Paso 3 */}
            <div class="relative group">
              <div
                class="absolute -inset-4 bg-gradient-to-r from-acento-azul/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-300"
              >
              </div>
              <div
                class="relative bg-gradient-to-br from-fondo-panel/50 to-fondo-panel/30 backdrop-blur-sm border border-fondo-borde/50 rounded-xl p-6 text-center"
              >
                <div
                  class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-br from-acento-azul/20 to-acento-azul/10 text-3xl font-bold text-acento-azul mb-6 mx-auto border-2 border-acento-azul/30"
                >
                  3
                </div>
                <h3 class="text-xl font-bold text-texto-principal mb-3">
                  Interrogar
                </h3>
                <p class="text-texto-secundario text-sm leading-relaxed">
                  Estudia sospechosos, sus motivaciones y coartadas
                </p>
              </div>
            </div>

            {/* Paso 4 */}
            <div class="relative group">
              <div
                class="absolute -inset-4 bg-gradient-to-r from-acento-turquesa/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-300"
              >
              </div>
              <div
                class="relative bg-gradient-to-br from-fondo-panel/50 to-fondo-panel/30 backdrop-blur-sm border border-fondo-borde/50 rounded-xl p-6 text-center"
              >
                <div
                  class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-br from-acento-turquesa/20 to-acento-turquesa/10 text-3xl font-bold text-acento-turquesa mb-6 mx-auto border-2 border-acento-turquesa/30"
                >
                  4
                </div>
                <h3 class="text-xl font-bold text-texto-principal mb-3">
                  Resolver
                </h3>
                <p class="text-texto-secundario text-sm leading-relaxed">
                  Propón al culpable y descubre si acertaste
                </p>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>

  <style>
    /* Efectos específicos para juego de investigación */
    @keyframes case-file-open {
      0% {
        transform: rotateX(60deg);
        opacity: 0;
      }
      100% {
        transform: rotateX(0);
        opacity: 1;
      }
    }

    @keyframes evidence-glow {
      0%,
      100% {
        box-shadow: 0 0 20px rgba(77, 163, 255, 0.1);
      }
      50% {
        box-shadow: 0 0 30px rgba(77, 163, 255, 0.2);
      }
    }

    @keyframes typewriter {
      from {
        width: 0;
      }
      to {
        width: 100%;
      }
    }

    @keyframes blink-cursor {
      from,
      to {
        border-color: transparent;
      }
      50% {
        border-color: #4da3ff;
      }
    }

    /* Clases de utilidad para efectos de juego */
    .case-file {
      animation: case-file-open 0.8s ease-out;
      transform-style: preserve-3d;
    }

    .evidence-glow {
      animation: evidence-glow 2s ease-in-out infinite;
    }

    .typewriter-text {
      overflow: hidden;
      border-right: 2px solid;
      white-space: nowrap;
      animation:
        typewriter 3.5s steps(40, end),
        blink-cursor 0.75s step-end infinite;
    }

    /* Efecto de papel/carpeta */
    .paper-texture {
      background-image:
        linear-gradient(90deg, rgba(77, 163, 255, 0.03) 1px, transparent 1px),
        linear-gradient(rgba(77, 163, 255, 0.03) 1px, transparent 1px);
      background-size: 20px 20px;
    }

    /* Estilos de botones de juego mejorados */
    .game-btn-primary {
      background: linear-gradient(
        145deg,
        rgba(16, 26, 46, 0.9) 0%,
        rgba(11, 18, 32, 0.95) 100%
      );
      border: 2px solid;
      border-image: linear-gradient(
          135deg,
          rgba(77, 163, 255, 0.5),
          rgba(94, 234, 212, 0.3)
        )
        1;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .game-btn-primary:hover {
      border-image: linear-gradient(
          135deg,
          rgba(77, 163, 255, 0.8),
          rgba(94, 234, 212, 0.6)
        )
        1;
      transform: translateY(-2px);
      box-shadow:
        0 10px 25px rgba(0, 0, 0, 0.3),
        0 5px 15px rgba(77, 163, 255, 0.1);
    }

    .game-btn-primary:active {
      transform: translateY(0);
    }

    .game-btn-primary::before {
      content: "";
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(
        90deg,
        transparent,
        rgba(255, 255, 255, 0.1),
        transparent
      );
      transition: left 0.5s;
    }

    .game-btn-primary:hover::before {
      left: 100%;
    }

    /* Estilo para botón de caso activo */
    .active-case-btn {
      border-color: rgba(94, 234, 212, 0.5) !important;
      animation: evidence-glow 3s ease-in-out infinite;
    }

    .active-case-btn:hover {
      border-color: rgba(94, 234, 212, 0.8) !important;
    }

    /* Estilo de contadores */
    .counter-pulse {
      animation: pulse 2s ease-in-out infinite;
    }

    /* Responsive mejorado */
    @media (max-width: 768px) {
      .case-file {
        width: 48px;
        height: 48px;
      }

      .game-btn-primary {
        padding: 0.75rem 1.5rem;
        font-size: 1rem;
      }
    }

    /* Mejoras de accesibilidad */
    @media (prefers-reduced-motion: reduce) {
      .case-file,
      .evidence-glow,
      .typewriter-text,
      .counter-pulse {
        animation: none;
      }

      .game-btn-primary:hover {
        transform: none;
      }
    }
  </style>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // Verificar caso activo desde el store de Zustand
      const storeData = localStorage.getItem("yo-no-fui-storage");
      const continuarBtn = document.getElementById("continuar-btn");
      const casosActivosCounter = document.getElementById(
        "casos-activos-counter"
      );
      const casosResueltosCounter = document.getElementById(
        "casos-resueltos-counter"
      );

      if (storeData) {
        try {
          const parsedStore = JSON.parse(storeData);
          const casoActivo = parsedStore.state && parsedStore.state.casoActual;

          if (casoActivo && casoActivo.id && !casoActivo.resuelto) {
            continuarBtn.classList.remove("hidden");
            continuarBtn.classList.add("active-case-btn");
            if (casosActivosCounter) {
              casosActivosCounter.textContent = "1";
            }
          } else {
            if (continuarBtn) continuarBtn.classList.add("hidden");
            if (casosActivosCounter) casosActivosCounter.textContent = "0";
          }
        } catch (e) {
          console.error("Error parsing game store in index:", e);
        }
      }

      // Calcular estadísticas
      const historial = JSON.parse(
        localStorage.getItem("historial-casos") || "[]"
      );
      const casosResueltos = historial.filter((c) => c.resuelto).length;
      casosResueltosCounter.textContent = casosResueltos;

      // Efecto de escritura en el título principal
      const title = document.querySelector("[data-typewriter]");

      if (title) {
        const text = title.textContent.trim();
        title.textContent = "";

        let i = 0;

        const typeWriter = () => {
          if (i < text.length) {
            title.textContent += text.charAt(i);
            i++;
            setTimeout(typeWriter, 80);
          }
        };

        // Delay inicial
        setTimeout(typeWriter, 800);
      }

      // Efecto hover en tarjetas de características
      const featureCards = document.querySelectorAll(
        ".bg-gradient-to-br.from-fondo-panel\\/50"
      );
      featureCards.forEach((card) => {
        card.addEventListener("mouseenter", function () {
          const icon = this.querySelector("svg");
          if (icon) {
            icon.style.transform = "scale(1.1)";
          }
        });

        card.addEventListener("mouseleave", function () {
          const icon = this.querySelector("svg");
          if (icon) {
            icon.style.transform = "scale(1)";
          }
        });
      });

      // Contador animado para casos resueltos
      const counter = document.getElementById("casos-resueltos-counter");
      if (counter && casosResueltos > 0) {
        let count = 0;
        const target = casosResueltos;
        const duration = 1500;
        const increment = target / (duration / 16);

        const updateCounter = () => {
          count += increment;
          if (count < target) {
            counter.textContent = Math.floor(count);
            requestAnimationFrame(updateCounter);
          } else {
            counter.textContent = target;
          }
        };

        // Iniciar animación después de un delay
        setTimeout(() => {
          requestAnimationFrame(updateCounter);
        }, 500);
      }
    });
  </script>
</MainLayout>
